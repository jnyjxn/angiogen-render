find_package(Java COMPONENTS Development)
find_package(JNI)

IF (NOT Java_FOUND)
  MESSAGE(FATAL_ERROR "Java was not found, you need to install it, on openSUSE, I use sudo zypper install java-11-openjdk")
ENDIF ()

IF (NOT JNI_FOUND)
  MESSAGE(FATAL_ERROR "JNI was not found, you need to install it, on openSUSE, I use sudo zypper install java-11-openjdk")
ENDIF ()

include(UseJava)
INCLUDE_DIRECTORIES(${JNI_INCLUDE_DIRS})

SET (module gvxrJava)


configure_file(../gvxrWrapper-doc.in ${CMAKE_CURRENT_BINARY_DIR}/gvxrJava.i)
SET_PROPERTY(SOURCE ${CMAKE_CURRENT_BINARY_DIR}/gvxrJava.i PROPERTY CPLUSPLUS ON)

# Add swig module
IF(${CMAKE_VERSION} VERSION_LESS "3.8.0")
    SWIG_ADD_MODULE(${module} java ${CMAKE_CURRENT_BINARY_DIR}/${module}.i)
ELSE (${CMAKE_VERSION} VERSION_LESS "3.8.0")
    SWIG_ADD_LIBRARY(${module} LANGUAGE java SOURCES ${CMAKE_CURRENT_BINARY_DIR}/${module}.i)
ENDIF (${CMAKE_VERSION} VERSION_LESS "3.8.0")

set_property(
    SOURCE ${CMAKE_CURRENT_BINARY_DIR}/${module}.i
    PROPERTY SWIG_MODULE_NAME ${module})

swig_link_libraries(${module} ${SimpleGVXR_LIBRARY} ${SimpleGVXR_LIBRARIES} ${JNI_LIBRARIES})

IF (USE_SUPERBUILD)
    ADD_DEPENDENCIES(${module} SimpleGVXR)
ENDIF ()

configure_file(test.java.in ${CMAKE_CURRENT_BINARY_DIR}/test.java)
FILE(COPY ../welsh-dragon-small.stl DESTINATION ${CMAKE_CURRENT_BINARY_DIR})
FILE(COPY runJavaTest.sh
		DESTINATION ${CMAKE_CURRENT_BINARY_DIR}
		FILE_PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE GROUP_READ
  			GROUP_EXECUTE WORLD_READ WORLD_EXECUTE)

add_jar(testJava_temp ${CMAKE_CURRENT_BINARY_DIR}/test.java)
add_jar(testJava ${CMAKE_CURRENT_SOURCE_DIR}/test.java)




install(FILES
    ${CMAKE_CURRENT_BINARY_DIR}/${module}.java
    DESTINATION ${CMAKE_INSTALL_PREFIX}/${INSTALL_DIR}/java
    COMPONENT Java)


install(FILES
    ${CMAKE_CURRENT_BINARY_DIR}/testJava.jar
    DESTINATION ${CMAKE_INSTALL_PREFIX}/${INSTALL_DIR}/java
    COMPONENT Demos)

IF (UNIX)
    IF (APPLE)
        install(FILES
            ${CMAKE_CURRENT_BINARY_DIR}/lib${module}.jnilib
            DESTINATION ${CMAKE_INSTALL_PREFIX}/${INSTALL_DIR}/java
            PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE
            COMPONENT Java)
    ELSE (APPLE)
        install(FILES
            ${CMAKE_CURRENT_BINARY_DIR}/lib${module}.so
            DESTINATION ${CMAKE_INSTALL_PREFIX}/${INSTALL_DIR}/java
            PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE
            COMPONENT Java)
    ENDIF (APPLE)

    install(FILES
        ${CMAKE_CURRENT_BINARY_DIR}/runJavaTest.sh
        DESTINATION ${CMAKE_INSTALL_PREFIX}/${INSTALL_DIR}/java
        PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE
        COMPONENT Demos)
ENDIF (UNIX)

SET (CPACK_COMPONENTS_ALL ${CPACK_COMPONENTS_ALL}  Java PARENT_SCOPE)
