<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="generator" content="hevea 2.14">
<style type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50\char045;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding0 tr td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100\char045;background-color:black;}
.hfill{border:none;height:1px;width:200\char045;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20\char045; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
.lstlisting{font-family:monospace;white-space:pre;margin-right:auto;margin-left:0pt;text-align:left}
</style>
<title>gVirtualXRay -- Tutorial 02 -- GLUT:  
		Loading the shader program from a file compressed with the Z library. 
		Adding an efficient mouse control to turn the 3D scene.
</title>
</head>
<body >
<!--HEVEA command line is: hevea -fix tutorial-02-glut.tex -->
<!--CUT STYLE article--><!--CUT DEF section 1 --><table class="title"><tr><td style="padding:1ex"><h1 class="titlemain">gVirtualXRay &#X2013; Tutorial 02 &#X2013; GLUT: <br>
		Loading the shader program from a file compressed with the Z library.<br>
		Adding an efficient mouse control to turn the 3D scene.</h1><h3 class="titlerest">Dr Franck P. Vidal</h3><h3 class="titlerest">27<sup>th</sup> September 2014</h3></td></tr>
</table><div class="center">
<img src="tutorial-02-glut001.png">
</div><!--TOC section id="sec1" Contents-->
<h2 id="sec1" class="section">Contents</h2><!--SEC END --><ul class="toc"><li class="li-toc">
Table of contents
</li><li class="li-toc"><a href="#sec2">1&#XA0;&#XA0;Introduction</a>
</li><li class="li-toc"><a href="#sec3">2&#XA0;&#XA0;Header inclusion</a>
</li><li class="li-toc"><a href="#sec4">3&#XA0;&#XA0;Name Spaces</a>
</li><li class="li-toc"><a href="#sec5">4&#XA0;&#XA0;Global Variables</a>
</li><li class="li-toc"><a href="#sec6">5&#XA0;&#XA0;Function Declarations</a>
</li><li class="li-toc"><a href="#sec7">6&#XA0;&#XA0;Shader Initialisation</a>
</li><li class="li-toc"><a href="#sec8">7&#XA0;&#XA0;Callback for Mouse Button Events</a>
</li><li class="li-toc"><a href="#sec9">8&#XA0;&#XA0;Callback for Cursor Position Events</a>
</li><li class="li-toc"><a href="#sec10">9&#XA0;&#XA0;Conversion from Screen Coordinates to Arcball Vector</a>
</li><li class="li-toc"><a href="#sec11">10&#XA0;&#XA0;Radian to Degree Conversion</a>
</li><li class="li-toc"><a href="#sec12">11&#XA0;&#XA0;Compute Rotation Matrix</a>
</li><li class="li-toc"><a href="#sec13">12&#XA0;&#XA0;Next Tutorial...</a>
</li><li class="li-toc"><a href="#sec14">A&#XA0;&#XA0;Program Source Code</a>
</li></ul>
<!--TOC section id="sec2" Introduction-->
<h2 id="sec2" class="section">1&#XA0;&#XA0;Introduction</h2><!--SEC END --><p>The complete source code of this tutorial is available in 
Appendix&#XA0;<a href="#sec%3AProgram%20Source%20Code">A</a> and on the Subversion (SVN) repository 
at 
<code>tutorials/tutorial_02_glut/tutorial_02_glut.cxx</code>. 
It can be downloaded here: 
<a href="
https://sourceforge.net/p/gvirtualxray/code/HEAD/tree/trunk/tutorials/tutorial_02_glut/tutorial_02_glut.cxx"><span style="font-family:monospace">
https://sourceforge.net/p/gvirtualxray/code/HEAD/tree/trunk/tutorials/tutorial_02_glut/tutorial_02_glut.cxx</span></a>.
It improves the 1st tutorial in two ways:
</p><ol class="enumerate" type=1><li class="li-enumerate">
	Loading the shader program from a file compressed with the Z library.
	</li><li class="li-enumerate">Adding an efficient mouse control to turn the 3D scene.
</li></ol><p>
Two cubes are displayed (see Figure&#XA0;<a href="#fig%3Ascene">1</a>). 
</p><blockquote class="figure"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>
<img src="tutorial-02-glut002.png">
<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 1: <a id="fig:scene"></a> Screen capture of the second tutorial.</td></tr>
</table></div>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p>
First the fragment program is saved into <code>tutorial_02_gl2.frag</code>. 
The vertex program is saved into <code>tutorial_02_gl2.vert</code>. 
Our implementation supports OpenGL 2.x only when GLUT is used. 
OpenGL 3.x and OpenGL 4.x or above are supported when GLFW is used. 
The files are individually compressed using <span style="font-style:italic">gzip</span>&#XA0;<sup><a id="text1" href="#note1">1</a></sup>. 
Finally each compressed file is converted into a C header file. 
It can be achieved CMake&#XA0;<sup><a id="text2" href="#note2">2</a></sup> or an external tool such as bin2c&#XA0;<sup><a id="text3" href="#note3">3</a></sup>. </p><p>The tutorial is organised as follows:
</p><ul class="itemize"><li class="li-itemize">
Section&#XA0;<a href="#sec%3AHeader%20inclusion">2</a> shows the header files to include. </li><li class="li-itemize">Section&#XA0;<a href="#sec%3AName%20Spaces">3</a> shows some of the name spaces that can be 
	included to lighten the code. 
	</li><li class="li-itemize">Section&#XA0;<a href="#sec%3AGlobal%20Variables">4</a> shows the global variables that are 
	used. </li><li class="li-itemize">Section&#XA0;<a href="#sec%3AFunction%20Declarations">5</a> what functions have to 
	be declared. </li><li class="li-itemize">Section&#XA0;<a href="#sec%3AInitialise%20Shaders">6</a> shows how to initialise the shaders from compressed data stored in C header files. </li><li class="li-itemize">Section&#XA0;<a href="#mouseButtonCallback">7</a> shows the callback for mouse button events. 
The mouse is used to rotate objects in an intuitive way. </li><li class="li-itemize">Section&#XA0;<a href="#cursorPosCallback">8</a> shows how callback for cursor position events works. </li><li class="li-itemize">How to convert screen coordinates to arcball vectors is explained in Section&#XA0;<a href="#getArcballVector">9</a> </li><li class="li-itemize">The conversion from radian to degree is shown in Section&#XA0;<a href="#radian2degree">10</a>.</li><li class="li-itemize">Section&#XA0;<a href="#computeRotation">11</a> shows how the corresponding rotation matrix is computed. </li><li class="li-itemize">Section&#XA0;<a href="#sec%3ANext%20Tutorial">12</a> gives a preview of what the next 
tutorial will be about.</li><li class="li-itemize">Appendix&#XA0;<a href="#sec%3AProgram%20Source%20Code">A</a> shows the source code of this 
	tutorial. 
		
</li></ul>
<!--TOC section id="sec3" Header inclusion-->
<h2 id="sec3" class="section">2&#XA0;&#XA0;Header inclusion</h2><!--SEC END --><p>
<a id="sec:Header inclusion"></a></p><p>Listing&#XA0;<a href="#lst%3Aheader">1</a> only shows the new i) the macros that have to be defines to include 
OpenGL core profile headers and ii) the header files that need to be included to decompress the data using the <span style="font-weight:bold">zlib</span> library&#XA0;<sup><a id="text4" href="#note4">4</a></sup>:
</p><ul class="itemize"><li class="li-itemize">
<code>gVirtualXRay/Utilities.h</code> is the new header file that is used to handle decompression using the Z library. 
</li><li class="li-itemize"><code>tutorial_02_gl2.frag.h</code> is the compressed fragment shader for OpenGL 2.x. 
</li><li class="li-itemize"><code>tutorial_02_gl2.vert.h</code> is the compressed vertex shader for OpenGL 2.x. 
</li><li class="li-itemize">For other header files, see the GLUT version of Tutorial 1.
</li></ul><div class="center">

<div class="center">Listing&#XA0;1: <a id="lst:header"></a>Header inclusion.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F">  65</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  66</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Include</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  67</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  68</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">GL</span><span style="font-size:small">/</span><span style="font-size:small">glew</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Handle shaders</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  69</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  70</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Create an OpenGL context and attach a window to it</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  71</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">__APPLE__</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  72</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">GLUT</span><span style="font-size:small">/</span><span style="font-size:small">glut</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  73</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#else</span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  74</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">GL</span><span style="font-size:small">/</span><span style="font-size:small">glut</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  75</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#endif</span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  76</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  77</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;   </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Print error messages in the console</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  78</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">sstream</span><span style="font-size:small">&gt;    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Generate error messages</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  79</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">exception</span><span style="font-size:small">&gt;  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Catch C++ exception</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  80</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">cstdlib</span><span style="font-size:small">&gt;    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Define return status (EXIT_SUCCESS and EXIT_FAILURE)</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  81</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  82</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Define new types, e.g.~RATIONAL_NUMBER, VEC2, VEC3 and MATRIX4 to name a few</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  83</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/Types.h"</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  84</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  85</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Define units such as metre, kilometre, electronvolt, gram, kilogram, etc.</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  86</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/Units.h"</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  87</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  88</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Some utility functions about OpenGL, e.g. matrix stacks,</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  89</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// how to set the projection matrix, etc.</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  90</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/OpenGLUtilities.h"</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  91</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  92</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/PolygonMesh.h"</span></span></span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Handle 3D triangle meshes</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  93</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/Shader.h"</span></span></span><span style="font-size:small">       </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Handle GLSL programs</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  94</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  95</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/Utilities.h"</span></span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Handle decompression using the Z library</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  96</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  97</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"buildCube.h"</span></span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Create the triangle mesh of a cube</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  98</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F">  99</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"tutorial_02_gl2.frag.h"</span></span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Fragment shader for OpenGL 2.x</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 100</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"tutorial_02_gl2.vert.h"</span></span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Vertex shader for OpenGL 2.x</span></span></span></td></tr>
</table>
</div>
<!--TOC section id="sec4" Name Spaces-->
<h2 id="sec4" class="section">3&#XA0;&#XA0;Name Spaces</h2><!--SEC END --><p>
<a id="sec:Name Spaces"></a></p><p>See Tutorial 1.</p>
<!--TOC section id="sec5" Global Variables-->
<h2 id="sec5" class="section">4&#XA0;&#XA0;Global Variables</h2><!--SEC END --><p>
<a id="sec:Global Variables"></a></p><p>Listing&#XA0;<a href="#lst%3Aglobal%20variables">2</a> shows the global variables that are used:
</p><ul class="itemize"><li class="li-itemize"><code>g_rotation_speed</code> controls the speed of rotation of the cubes. </li><li class="li-itemize"><code>g_tutorial_02_gl2_frag</code> is declared in <code>tutorial_02_gl2.frag.h</code>. 
It is the compressed fragment shader for OpenGL 2.x.</li><li class="li-itemize"><code>g_tutorial_02_gl2_vert</code> is declared in <code>tutorial_02_gl2.vert.h</code>. 
It is the compressed vertex shader for OpenGL 2.x.</li><li class="li-itemize"><code>bool g_use_arc_ball</code> is used to know if arc ball rotation is currently in use.</li><li class="li-itemize"><code>int g_button</code> stores which button generated an event last.</li><li class="li-itemize"><code>int g_button_state</code> stores the new state of this button.</li><li class="li-itemize"><code>GLint g_last_x_position</code> is the previous last known X position of the cursor.</li><li class="li-itemize"><code>GLint g_last_y_position</code> is the previous last known Y position of the cursor.</li><li class="li-itemize"><code>GLint g_current_x_position</code> is the current X position of the cursor.</li><li class="li-itemize"><code>GLint g_current_y_position</code> is the current Y position of the cursor.<p>	 </p></li><li class="li-itemize">For other global variables, see the GLUT version of Tutorial 1.
</li></ul><div class="center">

<div class="center">Listing&#XA0;2: <a id="lst:global variables"></a>Global variables.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F"> 110</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 111</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Constant variables</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 112</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 113</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">const</span></span><span style="font-size:small"> </span><span style="font-size:small">GLfloat</span><span style="font-size:small"> </span><span style="font-size:small">g_rotation_speed</span><span style="font-size:small">(2.0);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 114</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 115</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 116</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 117</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Global variables</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 118</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 119</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Keep track of the window width</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 120</span></span><span style="font-size:small"> </span><span style="font-size:small">GLsizei</span><span style="font-size:small"> </span><span style="font-size:small">g_window_width</span><span style="font-size:small">(640);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 121</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 122</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Keep track of the window height</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 123</span></span><span style="font-size:small"> </span><span style="font-size:small">GLsizei</span><span style="font-size:small"> </span><span style="font-size:small">g_window_height</span><span style="font-size:small">(480);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 124</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 125</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// GLUT window ID</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 126</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">g_window_id</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 127</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 128</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Shader program used to display the 3D scene</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 129</span></span><span style="font-size:small"> </span><span style="font-size:small">Shader</span><span style="font-size:small"> </span><span style="font-size:small">g_display_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 130</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 131</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// 3D objects as VAOs and VBOs</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 132</span></span><span style="font-size:small"> </span><span style="font-size:small">PolygonMesh</span><span style="font-size:small"> </span><span style="font-size:small">g_polygon_mesh_1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 133</span></span><span style="font-size:small"> </span><span style="font-size:small">PolygonMesh</span><span style="font-size:small"> </span><span style="font-size:small">g_polygon_mesh_2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 134</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 135</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Transformation matrices</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 136</span></span><span style="font-size:small"> </span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">g_object_1_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 137</span></span><span style="font-size:small"> </span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">g_object_2_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 138</span></span><span style="font-size:small"> </span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">g_scene_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 139</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 140</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Geometric data</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 141</span></span><span style="font-size:small"> </span><span style="font-size:small">vector</span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">g_p_vertex_set_1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 142</span></span><span style="font-size:small"> </span><span style="font-size:small">vector</span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="color:blue">unsigned</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">g_p_index_set_1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 143</span></span><span style="font-size:small"> </span><span style="font-size:small">vector</span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">g_p_vertex_set_2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 144</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 145</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Control the zoom</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 146</span></span><span style="font-size:small"> </span><span style="font-size:small">RATIONAL_NUMBER</span><span style="font-size:small"> </span><span style="font-size:small">g_zoom</span><span style="font-size:small">(50.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 147</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 148</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Use the arc ball rotation</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 149</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">bool</span></span><span style="font-size:small"> </span><span style="font-size:small">g_use_arc_ball</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">false</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 150</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 151</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// States of the mouse</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 152</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">g_button</span><span style="font-size:small">(-1); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Button</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 153</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">g_button_state</span><span style="font-size:small">(-1); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Button state</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 154</span></span><span style="font-size:small"> </span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">g_last_x_position</span><span style="font-size:small">(0); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Previous x position of the cursor</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 155</span></span><span style="font-size:small"> </span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small">(0); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Previous y position of the cursor</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 156</span></span><span style="font-size:small"> </span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">g_current_x_position</span><span style="font-size:small">(0); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Current x position of the cursor</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 157</span></span><span style="font-size:small"> </span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small">(0); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Current x position of the cursor</span></span></span></td></tr>
</table>
</div>
<!--TOC section id="sec6" Function Declarations-->
<h2 id="sec6" class="section">5&#XA0;&#XA0;Function Declarations</h2><!--SEC END --><p>
<a id="sec:Function Declarations"></a></p><p>One function has been added to load shaders from compressed files and five functions have been add to control the rotation using the mouse: 
</p><ul class="itemize"><li class="li-itemize">
<code>initShader</code> is used i) to decompress the shaders, and ii) to compile the shaders (see Section&#XA0;<a href="#sec%3AInitialise%20Shaders">6</a>).</li><li class="li-itemize"><code>mouseButtonCallback</code> is called when a mouse button event occurs (see Section&#XA0;<a href="#mouseButtonCallback">7</a>).</li><li class="li-itemize"><code>cursorPosCallback</code> is used when the mouse moves (see Section&#XA0;<a href="#cursorPosCallback">8</a>).</li><li class="li-itemize"><code>getArcballVector</code> computes the arc ball vector given screen coordinates (see Section&#XA0;<a href="#getArcballVector">9</a>). 
Details about arc ball rotation can be found at <a href="http://en.wikibooks.org/wiki/OpenGL_Programming/Modern_OpenGL_Tutorial_Arcball"><span style="font-family:monospace">http://en.wikibooks.org/wiki/OpenGL_Programming/Modern_OpenGL_Tutorial_Arcball</span></a> and <a href="http://nehe.gamedev.net/tutorial/arcball_rotation/19003/"><span style="font-family:monospace">http://nehe.gamedev.net/tutorial/arcball_rotation/19003/</span></a>. </li><li class="li-itemize"><code>radian2degree</code> converts an angle value in radians into degrees (see Section&#XA0;<a href="#radian2degree">10</a>).</li><li class="li-itemize"><code>computeRotation</code> generates the corresponding matrix rotation (see Section&#XA0;<a href="#computeRotation">11</a>).
</li></ul><p>
Listing&#XA0;<a href="#lst%3Afunction%20declarations">3</a> shows the declaration of all the functions. </p><div class="center">

<div class="center">Listing&#XA0;3: <a id="lst:function declarations"></a>Function declarations.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F"> 160</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 161</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Function declaration</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 162</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 163</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGLUT</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 164</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGLEW</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 165</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGL</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 166</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initShader</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 167</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">load3DObjects</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 168</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">displayCallback</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 169</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">idleCallback</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 170</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">quitCallback</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 171</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aWidth</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aHeight</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 172</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">keyCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">unsigned</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small"> </span><span style="font-size:small">aKey</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 173</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">mouseButtonCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aButton</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aState</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 174</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">cursorPosCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 175</span></span><span style="font-size:small"> </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">getArcballVector</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">x</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">y</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 176</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">radian2degree</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">anAngle</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 177</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">computeRotation</span><span style="font-size:small">(</span><span style="font-size:small">MATRIX4</span><span style="font-size:small">&amp; </span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small">);</span></td></tr>
</table>
</div>
<!--TOC section id="sec7" Shader Initialisation-->
<h2 id="sec7" class="section">6&#XA0;&#XA0;Shader Initialisation</h2><!--SEC END --><p>
<a id="sec:Initialise Shaders"></a></p><ul class="itemize"><li class="li-itemize">
<code>g_display_shader</code> is the instance of the Shader class that will store our GLSL programs. </li><li class="li-itemize"><code>g_tutorial_02_gl3_vert</code> is declared in <code>tutorial_02_gl3.vert.h</code>. 
It is the compressed vertex shader for OpenGL 3.x or OpenGL 4.x. 
To generate the file, the text file containing our vertex shader was compressed using Gzip. 
A C header was then generated from the compressed file. 
It can be done using bin2c or CMake. 
There is no need to distribute text files with the executable file that reads the code at runtime. 
The code of the shader is embedded in the executable file. </li><li class="li-itemize">The same is done for the fragment shader. 
<code>g_tutorial_02_gl2_frag</code> is declared in <code>tutorial_02_gl2.frag.h</code>. 
It is the compressed fragment shader for OpenGL 3.x or OpenGL 4.x.</li><li class="li-itemize"><code>g_tutorial_02_gl3_vert</code> is decompressed into <code>p_vertex_shader</code>, 
<code>g_tutorial_02_gl3_frag</code> into <code>p_fragment_shader</code>, using the <code>inflate</code> function that will invoke Z library. </li><li class="li-itemize">Error codes are stored in <code>z_lib_return_code_vertex</code> and <code>z_lib_return_code_fragment</code>. 
They are used to make sure the decompression has been successful. </li><li class="li-itemize">The source of the shaders are then saved into two separate <code>std::string</code> instances (<code>vertex_shader</code> and <code>fragment_shader</code>). </li><li class="li-itemize">If a decompression error occurred, an exception is thrown. </li><li class="li-itemize">To help debugging, it is possible to give the vertex and fragment programs labels: 
<code>g_display_shader.setLabels("display.vert", "display.frag")</code>. </li><li class="li-itemize">Finally, the Shader instance <code>g_display_shader</code> loads the source code. 
</li></ul><p>
Listing&#XA0;<a href="#lst%3AInitialise%20Shaders">4</a> shows how to perform all these steps.
</p><div class="center">

<div class="center">Listing&#XA0;4: <a id="lst:Initialise Shaders"></a>Shader initialisation.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F"> 272</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//---------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 273</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initShader</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 274</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//---------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 275</span></span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 276</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Initialise the shaders</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 277</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">* </span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 278</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">* </span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 279</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 280</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">z_lib_return_code_vertex</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 281</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">z_lib_return_code_fragment</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 282</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 283</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">std</span><span style="font-size:small">::</span><span style="font-size:small">string</span><span style="font-size:small"> </span><span style="font-size:small">vertex_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 284</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">std</span><span style="font-size:small">::</span><span style="font-size:small">string</span><span style="font-size:small"> </span><span style="font-size:small">fragment_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 285</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 286</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// L-buffer</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 287</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">z_lib_return_code_vertex</span><span style="font-size:small">   = </span><span style="font-size:small">inflate</span><span style="font-size:small">(</span><span style="font-size:small">g_tutorial_02_gl2_vert</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">sizeof</span></span><span style="font-size:small">(</span><span style="font-size:small">g_tutorial_02_gl2_vert</span><span style="font-size:small">),   &amp;</span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 288</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">z_lib_return_code_fragment</span><span style="font-size:small"> = </span><span style="font-size:small">inflate</span><span style="font-size:small">(</span><span style="font-size:small">g_tutorial_02_gl2_frag</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">sizeof</span></span><span style="font-size:small">(</span><span style="font-size:small">g_tutorial_02_gl2_frag</span><span style="font-size:small">), &amp;</span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 289</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 290</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">vertex_shader</span><span style="font-size:small">   = </span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 291</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">fragment_shader</span><span style="font-size:small"> = </span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 292</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">delete</span></span><span style="font-size:small"> [] </span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small">;     </span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small"> = 0;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 293</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">delete</span></span><span style="font-size:small"> [] </span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small">; </span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small"> = 0;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 294</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 295</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">z_lib_return_code_vertex</span><span style="font-size:small"> &lt;= 0 || </span><span style="font-size:small">z_lib_return_code_fragment</span><span style="font-size:small"> &lt;= 0 || !</span><span style="font-size:small">vertex_shader</span><span style="font-size:small">.</span><span style="font-size:small">size</span><span style="font-size:small">() || !</span><span style="font-size:small">fragment_shader</span><span style="font-size:small">.</span><span style="font-size:small">size</span><span style="font-size:small">())</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 296</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 297</span></span><span style="font-size:small"> </span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:blue">throw</span></span><span style="font-size:small"> </span><span style="font-size:small">Exception</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"Cannot decode the shader using ZLib."</span></span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 298</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 299</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_display_shader</span><span style="font-size:small">.</span><span style="font-size:small">setLabels</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"display.vert"</span></span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"display.frag"</span></span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 300</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_display_shader</span><span style="font-size:small">.</span><span style="font-size:small">loadSource</span><span style="font-size:small">(</span><span style="font-size:small">vertex_shader</span><span style="font-size:small">, </span><span style="font-size:small">fragment_shader</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 301</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">checkOpenGLErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 302</span></span><span style="font-size:small"> </span><span style="font-size:small">}</span></td></tr>
</table>
</div>
<!--TOC section id="sec8" Callback for Mouse Button Events-->
<h2 id="sec8" class="section">7&#XA0;&#XA0;Callback for Mouse Button Events</h2><!--SEC END --><p>
<a id="mouseButtonCallback"></a></p><p>This callback stores the mouse states in global variables, i.e.&#XA0;which button generated an event, the type of events and the cursor&#X2019;s position in screen coordinates) (see Listing&#XA0;<a href="#lst%3AmouseButtonCallback">5</a>).
If the mouse button is pressed, then arcball rotation is in used. 
If the mouse button is released, then arcball rotation is stopped.</p><p>In <code>void initGLUT()</code>, the callback is registered as follows:
<code>glutMouseFunc(mouseButtonCallback)</code>.</p><div class="center">

<div class="center">Listing&#XA0;5: <a id="lst:mouseButtonCallback"></a>Callback for mouse button events.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F"> 529</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-------------------------------------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 530</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">mouseButtonCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aButton</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aState</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 531</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-------------------------------------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 532</span></span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 533</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_button</span><span style="font-size:small"> = </span><span style="font-size:small">aButton</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 534</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_button_state</span><span style="font-size:small"> = </span><span style="font-size:small">aState</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 535</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 536</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// This is a click event</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 537</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_button</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_LEFT_BUTTON</span><span style="font-size:small"> || </span><span style="font-size:small">g_button</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_RIGHT_BUTTON</span><span style="font-size:small"> || </span><span style="font-size:small">g_button</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_MIDDLE_BUTTON</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 538</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 539</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Use the arc ball</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 540</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_button_state</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_DOWN</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 541</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 542</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small">g_use_arc_ball</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="color:blue">true</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 543</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 544</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Stop using the arc ball</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 545</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">else</span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 546</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 547</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small">g_use_arc_ball</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="color:blue">false</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 548</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 549</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 550</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small"> </span><span style="font-size:small">xpos</span><span style="font-size:small">(</span><span style="font-size:small">aXPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 551</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small"> </span><span style="font-size:small">ypos</span><span style="font-size:small">(</span><span style="font-size:small">aYPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 552</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 553</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_last_x_position</span><span style="font-size:small"> = </span><span style="font-size:small">xpos</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 554</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small"> = </span><span style="font-size:small">ypos</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 555</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 556</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_current_x_position</span><span style="font-size:small"> = </span><span style="font-size:small">xpos</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 557</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small"> = </span><span style="font-size:small">ypos</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 558</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 559</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 560</span></span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// The button is down</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 561</span></span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">aState</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_DOWN</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 562</span></span><span style="font-size:small"> </span><span style="font-size:small">  {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 563</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// This is a wheel event</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 564</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">aButton</span><span style="font-size:small"> == 3)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 565</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 566</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Change the zoom</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 567</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small">g_zoom</span><span style="font-size:small"> += 5 * </span><span style="font-size:small">cm</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 568</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 569</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Update the projection matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 570</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">, </span><span style="font-size:small">g_window_height</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 571</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 572</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// This is a wheel event</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 573</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">else</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">aButton</span><span style="font-size:small"> == 4)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 574</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 575</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Change the zoom</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 576</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small">g_zoom</span><span style="font-size:small"> -= 5 * </span><span style="font-size:small">cm</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 577</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 578</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Update the projection matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 579</span></span><span style="font-size:small"> </span><span style="font-size:small">      </span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">, </span><span style="font-size:small">g_window_height</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 580</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 581</span></span><span style="font-size:small"> </span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 582</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 583</span></span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Redisplay the scene</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 584</span></span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">glutPostRedisplay</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 585</span></span><span style="font-size:small"> </span><span style="font-size:small">}</span></td></tr>
</table>
</div>
<!--TOC section id="sec9" Callback for Cursor Position Events-->
<h2 id="sec9" class="section">8&#XA0;&#XA0;Callback for Cursor Position Events</h2><!--SEC END --><p>
<a id="cursorPosCallback"></a></p><p>Listing&#XA0;<a href="#lst%3AcursorPosCallback">6</a> shows i) how to store the cursor&#X2019;s position in global variables,and ii) 
how the matrix rotation is updated accordingly.</p><p>In <code>void initGLUT()</code>, the callback is registered as follows:
<code>glutMotionFunc(cursorPosCallback)</code>.</p><div class="center">

<div class="center">Listing&#XA0;6: <a id="lst:cursorPosCallback"></a>Callback for cursor position events.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F"> 588</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//----------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 589</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">cursorPosCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 590</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//----------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 591</span></span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 592</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_current_x_position</span><span style="font-size:small"> = </span><span style="font-size:small">aXPosition</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 593</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small"> = </span><span style="font-size:small">aYPosition</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 594</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 595</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">computeRotation</span><span style="font-size:small">(</span><span style="font-size:small">g_scene_rotation_matrix</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 596</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 597</span></span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Redisplay the scene</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 598</span></span><span style="font-size:small"> </span><span style="font-size:small">  </span><span style="font-size:small">glutPostRedisplay</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 599</span></span><span style="font-size:small"> </span><span style="font-size:small">}</span></td></tr>
</table>
</div>
<!--TOC section id="sec10" Conversion from Screen Coordinates to Arcball Vector-->
<h2 id="sec10" class="section">9&#XA0;&#XA0;Conversion from Screen Coordinates to Arcball Vector</h2><!--SEC END --><p>
<a id="getArcballVector"></a></p><p>Listing&#XA0;<a href="#lst%3AgetArcballVector">7</a> shows how to compute the arc ball vector given screen coordinates. 
Arcball rotation allows the user to rotate objects in a natural and intuitive way. 
Details about arc ball rotation can be found at <a href="http://en.wikibooks.org/wiki/OpenGL_Programming/Modern_OpenGL_Tutorial_Arcball"><span style="font-family:monospace">http://en.wikibooks.org/wiki/OpenGL_Programming/Modern_OpenGL_Tutorial_Arcball</span></a> and <a href="http://nehe.gamedev.net/tutorial/arcball_rotation/19003/"><span style="font-family:monospace">http://nehe.gamedev.net/tutorial/arcball_rotation/19003/</span></a>. </p><div class="center">

<div class="center">Listing&#XA0;7: <a id="lst:getArcballVector"></a>Conversion from screen coordinates to arc ball vector.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F"> 602</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//---------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 603</span></span><span style="font-size:small"> </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">getArcballVector</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">x</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">y</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 604</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//---------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 605</span></span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 606</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">P</span><span style="font-size:small">(2.0 * </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">(</span><span style="font-size:small">x</span><span style="font-size:small">) / </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">) - 1.0,</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 607</span></span><span style="font-size:small"> </span><span style="font-size:small">           2.0 * </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">(</span><span style="font-size:small">y</span><span style="font-size:small">) / </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">(</span><span style="font-size:small">g_window_height</span><span style="font-size:small">) - 1.0,</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 608</span></span><span style="font-size:small"> </span><span style="font-size:small">           0);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 609</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 610</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">setY</span><span style="font-size:small">(-</span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getY</span><span style="font-size:small">());</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 611</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 612</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">OP_squared</span><span style="font-size:small"> = </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getX</span><span style="font-size:small">() * </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getX</span><span style="font-size:small">() + </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getY</span><span style="font-size:small">() * </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getY</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 613</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">OP_squared</span><span style="font-size:small"> &lt;= 1.0)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 614</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 615</span></span><span style="font-size:small"> </span><span style="font-size:small">        </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">setZ</span><span style="font-size:small">(</span><span style="font-size:small">sqrt</span><span style="font-size:small">(1.0 - </span><span style="font-size:small">OP_squared</span><span style="font-size:small">));  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Pythagore</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 616</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 617</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">else</span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 618</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 619</span></span><span style="font-size:small"> </span><span style="font-size:small">        </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">normalise</span><span style="font-size:small">();  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Nearest point</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 620</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 621</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 622</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">return</span></span><span style="font-size:small"> (</span><span style="font-size:small">P</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 623</span></span><span style="font-size:small"> </span><span style="font-size:small">}</span></td></tr>
</table>
</div>
<!--TOC section id="sec11" Radian to Degree Conversion-->
<h2 id="sec11" class="section">10&#XA0;&#XA0;Radian to Degree Conversion</h2><!--SEC END --><p>
<a id="radian2degree"></a></p><p>&#X3C0; radians corresponds to 180&#XA0;degrees. 
Listing&#XA0;<a href="#lst%3Aradian2degree">8</a> shows how to perform this simple conversion. </p><div class="center">

<div class="center">Listing&#XA0;8: <a id="lst:radian2degree"></a>Convert an angle value from radian to degree.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F"> 626</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 627</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">radian2degree</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">anAngle</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 628</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 629</span></span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 630</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">return</span></span><span style="font-size:small"> (180.0 * </span><span style="font-size:small">anAngle</span><span style="font-size:small"> / </span><span style="font-size:small">gVirtualXRay</span><span style="font-size:small">::</span><span style="font-size:small">PI</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 631</span></span><span style="font-size:small"> </span><span style="font-size:small">}</span></td></tr>
</table>
</div>
<!--TOC section id="sec12" Compute Rotation Matrix-->
<h2 id="sec12" class="section">11&#XA0;&#XA0;Compute Rotation Matrix</h2><!--SEC END --><p>
<a id="computeRotation"></a></p><p>If the arcball rotation is currently in used, if the cursor&#X2019;s position has changed, then the rotation matrix is updated using the arcball technique
(see Listing&#XA0;<a href="#lst%3AcomputeRotation">9</a>). </p><div class="center">

<div class="center">Listing&#XA0;9: <a id="lst:computeRotation"></a>Compute the arcball rotation.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:xx-small"><span style="color:#7F7F7F"> 634</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 635</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">computeRotation</span><span style="font-size:small">(</span><span style="font-size:small">MATRIX4</span><span style="font-size:small">&amp; </span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 636</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 637</span></span><span style="font-size:small"> </span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 638</span></span><span style="font-size:small"> </span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_use_arc_ball</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 639</span></span><span style="font-size:small"> </span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 640</span></span><span style="font-size:small"> </span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_current_x_position</span><span style="font-size:small"> != </span><span style="font-size:small">g_last_x_position</span><span style="font-size:small"> || </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small"> != </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 641</span></span><span style="font-size:small"> </span><span style="font-size:small">        {</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 642</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">va</span><span style="font-size:small">(</span><span style="font-size:small">getArcballVector</span><span style="font-size:small">(</span><span style="font-size:small">g_last_x_position</span><span style="font-size:small">,    </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 643</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">vb</span><span style="font-size:small">(</span><span style="font-size:small">getArcballVector</span><span style="font-size:small">(</span><span style="font-size:small">g_current_x_position</span><span style="font-size:small">, </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 644</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 645</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">angle</span><span style="font-size:small">(</span><span style="font-size:small">g_rotation_speed</span><span style="font-size:small"> * </span><span style="font-size:small">radian2degree</span><span style="font-size:small">(</span><span style="font-size:small">acos</span><span style="font-size:small">(</span><span style="font-size:small">min</span><span style="font-size:small">(1.0, </span><span style="font-size:small">va</span><span style="font-size:small">.</span><span style="font-size:small">dotProduct</span><span style="font-size:small">(</span><span style="font-size:small">vb</span><span style="font-size:small">)))));</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 646</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 647</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">axis_in_camera_coord</span><span style="font-size:small">(</span><span style="font-size:small">va</span><span style="font-size:small"> ^ </span><span style="font-size:small">vb</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 648</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//axis_in_camera_coord.normalize();</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 649</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 650</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">camera2object</span><span style="font-size:small">(</span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small">.</span><span style="font-size:small">getInverse</span><span style="font-size:small">());</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 651</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">axis_in_object_coord</span><span style="font-size:small"> = </span><span style="font-size:small">camera2object</span><span style="font-size:small"> * </span><span style="font-size:small">axis_in_camera_coord</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 652</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//axis_in_object_coord.normalize();</span></span></span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 653</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 654</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 655</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">rotation_matrix</span><span style="font-size:small">.</span><span style="font-size:small">rotate</span><span style="font-size:small">(</span><span style="font-size:small">angle</span><span style="font-size:small">, </span><span style="font-size:small">axis_in_object_coord</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 656</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small"> = </span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small"> * </span><span style="font-size:small">rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 657</span></span><span style="font-size:small"> </span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 658</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">g_last_x_position</span><span style="font-size:small"> = </span><span style="font-size:small">g_current_x_position</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 659</span></span><span style="font-size:small"> </span><span style="font-size:small">            </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small"> = </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 660</span></span><span style="font-size:small"> </span><span style="font-size:small">        }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 661</span></span><span style="font-size:small"> </span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:xx-small"><span style="color:#7F7F7F"> 662</span></span><span style="font-size:small"> </span><span style="font-size:small">}</span></td></tr>
</table>
</div><p>	
</p>
<!--TOC section id="sec13" Next Tutorial...-->
<h2 id="sec13" class="section">12&#XA0;&#XA0;Next Tutorial...</h2><!--SEC END --><p>
<a id="sec:Next Tutorial"></a></p><p>In the next tutorial:
</p><ul class="itemize"><li class="li-itemize">
	Display two cubes with a better shader program and with transparency (one of the cubes is within the other one). 
	Do you see where we are going?
	
	</li><li class="li-itemize">Display the cubes in wireframe.
	
	</li><li class="li-itemize">Compute the X-ray attenuation of the cubes.
</li></ul>
<!--TOC section id="sec14" Program Source Code-->
<h2 id="sec14" class="section">A&#XA0;&#XA0;Program Source Code</h2><!--SEC END --><p>
<a id="sec:Program Source Code"></a></p><div class="center">

<div class="center">Listing&#XA0;10: <a id="lst:Program Source Code"></a>All the source code of this tutorial.</div><br>
<table class="lstframe" style="padding:1ex;background-color:white;border-style:solid;border-color:black;"><tr><td class="lstlisting"><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">/*</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">Copyright (c) 2014, Dr Franck P. Vidal (franck.p.vidal@fpvidal.net),</span><span style="font-size:small">
</span><span style="font-size:small">http://www.fpvidal.net/</span><span style="font-size:small">
</span><span style="font-size:small">All rights reserved.</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">Redistribution and use in source and binary forms, with or without modification,</span><span style="font-size:small">
</span><span style="font-size:small">are permitted provided that the following conditions are met:</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">1. Redistributions of source code must retain the above copyright notice,</span><span style="font-size:small">
</span><span style="font-size:small">this list of conditions and the following disclaimer.</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">2. Redistributions in binary form must reproduce the above copyright notice,</span><span style="font-size:small">
</span><span style="font-size:small">this list of conditions and the following disclaimer in the documentation and/or</span><span style="font-size:small">
</span><span style="font-size:small">other materials provided with the distribution.</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">3. Neither the name of the Bangor University nor the names of its contributors</span><span style="font-size:small">
</span><span style="font-size:small">may be used to endorse or promote products derived from this software without</span><span style="font-size:small">
</span><span style="font-size:small">specific prior written permission.</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND</span><span style="font-size:small">
</span><span style="font-size:small">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,</span><span style="font-size:small">
</span><span style="font-size:small">THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span><span style="font-size:small">
</span><span style="font-size:small">ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span><span style="font-size:small">
</span><span style="font-size:small">FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span><span style="font-size:small">
</span><span style="font-size:small">DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span><span style="font-size:small">
</span><span style="font-size:small">SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span><span style="font-size:small">
</span><span style="font-size:small">CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span><span style="font-size:small">
</span><span style="font-size:small">OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF</span><span style="font-size:small">
</span><span style="font-size:small">THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">*/</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">/**</span><span style="font-size:small">
</span><span style="font-size:small">********************************************************************************</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">*   @file       tutorial_02_glut.cxx</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">*   @brief      Improve the first tutorial by:</span><span style="font-size:small">
</span><span style="font-size:small">*               - Loading the shader program from a file compressed with the Z library.</span><span style="font-size:small">
</span><span style="font-size:small">*               - Adding an efficient mouse control to turn the 3D scene.</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">*   @version    1.0</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">*   @date       17/08/2014</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">*   @author     Dr Franck P. Vidal</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">*   @section    License</span><span style="font-size:small">
</span><span style="font-size:small">*               BSD 3-Clause License.</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">*               For details on use and redistribution please refer</span><span style="font-size:small">
</span><span style="font-size:small">*               to http://opensource.org/licenses/BSD-3-Clause</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">*   @section    Copyright</span><span style="font-size:small">
</span><span style="font-size:small">*               (c) by Dr Franck P. Vidal (franck.p.vidal@fpvidal.net),</span><span style="font-size:small">
</span><span style="font-size:small">*               http://www.fpvidal.net/, Dec 2014, 2014, version 1.0,</span><span style="font-size:small">
</span><span style="font-size:small">*               BSD 3-Clause License</span><span style="font-size:small">
</span><span style="font-size:small">*</span><span style="font-size:small">
</span><span style="font-size:small">********************************************************************************</span><span style="font-size:small">
</span><span style="font-size:small">*/</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Include</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">GL</span><span style="font-size:small">/</span><span style="font-size:small">glew</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Handle shaders</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Create an OpenGL context and attach a window to it</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#ifdef</span></span><span style="font-size:small"> </span><span style="font-size:small">__APPLE__</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">GLUT</span><span style="font-size:small">/</span><span style="font-size:small">glut</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#else</span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">GL</span><span style="font-size:small">/</span><span style="font-size:small">glut</span><span style="font-size:small">.</span><span style="font-size:small">h</span><span style="font-size:small">&gt;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#endif</span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">iostream</span><span style="font-size:small">&gt;   </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Print error messages in the console</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">sstream</span><span style="font-size:small">&gt;    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Generate error messages</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">exception</span><span style="font-size:small">&gt;  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Catch C++ exception</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> &lt;</span><span style="font-size:small">cstdlib</span><span style="font-size:small">&gt;    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Define return status (EXIT_SUCCESS and EXIT_FAILURE)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Define new types, e.g.~RATIONAL_NUMBER, VEC2, VEC3 and MATRIX4 to name a few</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/Types.h"</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Define units such as metre, kilometre, electronvolt, gram, kilogram, etc.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/Units.h"</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Some utility functions about OpenGL, e.g. matrix stacks,</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// how to set the projection matrix, etc.</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/OpenGLUtilities.h"</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/PolygonMesh.h"</span></span></span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Handle 3D triangle meshes</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/Shader.h"</span></span></span><span style="font-size:small">       </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Handle GLSL programs</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay/Utilities.h"</span></span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Handle decompression using the Z library</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"buildCube.h"</span></span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Create the triangle mesh of a cube</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"tutorial_02_gl2.frag.h"</span></span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Fragment shader for OpenGL 2.x</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">#include</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"tutorial_02_gl2.vert.h"</span></span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Vertex shader for OpenGL 2.x</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Name space</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">gVirtualXRay</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">using</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">namespace</span></span><span style="font-size:small"> </span><span style="font-size:small">std</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Constant variables</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">const</span></span><span style="font-size:small"> </span><span style="font-size:small">GLfloat</span><span style="font-size:small"> </span><span style="font-size:small">g_rotation_speed</span><span style="font-size:small">(2.0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Global variables</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Keep track of the window width</span></span></span><span style="font-size:small">
</span><span style="font-size:small">GLsizei</span><span style="font-size:small"> </span><span style="font-size:small">g_window_width</span><span style="font-size:small">(640);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Keep track of the window height</span></span></span><span style="font-size:small">
</span><span style="font-size:small">GLsizei</span><span style="font-size:small"> </span><span style="font-size:small">g_window_height</span><span style="font-size:small">(480);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// GLUT window ID</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">g_window_id</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Shader program used to display the 3D scene</span></span></span><span style="font-size:small">
</span><span style="font-size:small">Shader</span><span style="font-size:small"> </span><span style="font-size:small">g_display_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// 3D objects as VAOs and VBOs</span></span></span><span style="font-size:small">
</span><span style="font-size:small">PolygonMesh</span><span style="font-size:small"> </span><span style="font-size:small">g_polygon_mesh_1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">PolygonMesh</span><span style="font-size:small"> </span><span style="font-size:small">g_polygon_mesh_2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Transformation matrices</span></span></span><span style="font-size:small">
</span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">g_object_1_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">g_object_2_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">g_scene_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Geometric data</span></span></span><span style="font-size:small">
</span><span style="font-size:small">vector</span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">g_p_vertex_set_1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">vector</span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="color:blue">unsigned</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">g_p_index_set_1</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">vector</span><span style="font-size:small">&lt;</span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">&gt; </span><span style="font-size:small">g_p_vertex_set_2</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Control the zoom</span></span></span><span style="font-size:small">
</span><span style="font-size:small">RATIONAL_NUMBER</span><span style="font-size:small"> </span><span style="font-size:small">g_zoom</span><span style="font-size:small">(50.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Use the arc ball rotation</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">bool</span></span><span style="font-size:small"> </span><span style="font-size:small">g_use_arc_ball</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">false</span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// States of the mouse</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">g_button</span><span style="font-size:small">(-1); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Button</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">g_button_state</span><span style="font-size:small">(-1); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Button state</span></span></span><span style="font-size:small">
</span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">g_last_x_position</span><span style="font-size:small">(0); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Previous x position of the cursor</span></span></span><span style="font-size:small">
</span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small">(0); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Previous y position of the cursor</span></span></span><span style="font-size:small">
</span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">g_current_x_position</span><span style="font-size:small">(0); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Current x position of the cursor</span></span></span><span style="font-size:small">
</span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small">(0); </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Current x position of the cursor</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//  Function declaration</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//******************************************************************************</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGLUT</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGLEW</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGL</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initShader</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">load3DObjects</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">displayCallback</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">idleCallback</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">quitCallback</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aWidth</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aHeight</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">keyCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">unsigned</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small"> </span><span style="font-size:small">aKey</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">mouseButtonCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aButton</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aState</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">cursorPosCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">getArcballVector</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">x</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">y</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">radian2degree</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">anAngle</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">computeRotation</span><span style="font-size:small">(</span><span style="font-size:small">MATRIX4</span><span style="font-size:small">&amp; </span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-----------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">main</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-----------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Return code</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">return_code</span><span style="font-size:small">(</span><span style="font-size:small">EXIT_SUCCESS</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Register the exit callback</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">atexit</span><span style="font-size:small">(</span><span style="font-size:small">quitCallback</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">try</span></span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Initialise GLUT</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">initGLUT</span><span style="font-size:small">(</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Initialise GLEW</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">initGLEW</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Initialise OpenGL</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">initGL</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Initialise the shader from files compressed using the Z library</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">initShader</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Initialise the geometry of the 3D objects</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">load3DObjects</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Set the projection matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">, </span><span style="font-size:small">g_window_height</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Launch the event loop</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">glutMainLoop</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Catch exception if any</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">catch</span></span><span style="font-size:small"> (</span><span style="font-size:small"><span style="color:blue">const</span></span><span style="font-size:small"> </span><span style="font-size:small">exception</span><span style="font-size:small">&amp; </span><span style="font-size:small">error</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">cerr</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">error</span><span style="font-size:small">.</span><span style="font-size:small">what</span><span style="font-size:small">() &lt;&lt; </span><span style="font-size:small">endl</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">return_code</span><span style="font-size:small"> = </span><span style="font-size:small">EXIT_FAILURE</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Close the window and shut GLFW if needed</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">quitCallback</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Return an exit code</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">return</span></span><span style="font-size:small"> (</span><span style="font-size:small">return_code</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//----------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGLUT</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">** </span><span style="font-size:small">argv</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//----------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// GLUT initialisation</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">glutInit</span><span style="font-size:small"> (&amp;</span><span style="font-size:small">argc</span><span style="font-size:small">, </span><span style="font-size:small">argv</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Create a windowed mode window and its OpenGL context</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">glutInitWindowSize</span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">, </span><span style="font-size:small">g_window_height</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">glutInitDisplayMode</span><span style="font-size:small"> ( </span><span style="font-size:small">GLUT_RGB</span><span style="font-size:small"> | </span><span style="font-size:small">GLUT_DOUBLE</span><span style="font-size:small"> | </span><span style="font-size:small">GLUT_DEPTH</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_window_id</span><span style="font-size:small"> = </span><span style="font-size:small">glutCreateWindow</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"gVirtualXRay -- Tutorial 02"</span></span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// The window has not been created</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (!</span><span style="font-size:small">g_window_id</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:blue">throw</span></span><span style="font-size:small"> </span><span style="font-size:small">Exception</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">                </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"ERROR: cannot create a GLUT windowed mode window and its OpenGL context."</span></span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Register GLUT callbacks</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glutDisplayFunc</span><span style="font-size:small">(</span><span style="font-size:small">displayCallback</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glutReshapeFunc</span><span style="font-size:small">(</span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glutKeyboardFunc</span><span style="font-size:small">(</span><span style="font-size:small">keyCallback</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glutMouseFunc</span><span style="font-size:small">(</span><span style="font-size:small">mouseButtonCallback</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glutMotionFunc</span><span style="font-size:small">(</span><span style="font-size:small">cursorPosCallback</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glutIdleFunc</span><span style="font-size:small">(</span><span style="font-size:small">idleCallback</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGLEW</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">GLenum</span><span style="font-size:small"> </span><span style="font-size:small">err</span><span style="font-size:small"> = </span><span style="font-size:small">glewInit</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">GLEW_OK</span><span style="font-size:small"> != </span><span style="font-size:small">err</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">  {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">std</span><span style="font-size:small">::</span><span style="font-size:small">stringstream</span><span style="font-size:small"> </span><span style="font-size:small">error_message</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">error_message</span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"ERROR: cannot initialise GLEW:\t"</span></span></span><span style="font-size:small"> &lt;&lt; </span><span style="font-size:small">glewGetErrorString</span><span style="font-size:small">(</span><span style="font-size:small">err</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:blue">throw</span></span><span style="font-size:small"> </span><span style="font-size:small">Exception</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">, </span><span style="font-size:small">error_message</span><span style="font-size:small">.</span><span style="font-size:small">str</span><span style="font-size:small">());</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//---------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initShader</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//---------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Initialise the shaders</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">* </span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small">* </span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">z_lib_return_code_vertex</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">z_lib_return_code_fragment</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">std</span><span style="font-size:small">::</span><span style="font-size:small">string</span><span style="font-size:small"> </span><span style="font-size:small">vertex_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">std</span><span style="font-size:small">::</span><span style="font-size:small">string</span><span style="font-size:small"> </span><span style="font-size:small">fragment_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// L-buffer</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">z_lib_return_code_vertex</span><span style="font-size:small">   = </span><span style="font-size:small">inflate</span><span style="font-size:small">(</span><span style="font-size:small">g_tutorial_02_gl2_vert</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">sizeof</span></span><span style="font-size:small">(</span><span style="font-size:small">g_tutorial_02_gl2_vert</span><span style="font-size:small">),   &amp;</span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">z_lib_return_code_fragment</span><span style="font-size:small"> = </span><span style="font-size:small">inflate</span><span style="font-size:small">(</span><span style="font-size:small">g_tutorial_02_gl2_frag</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">sizeof</span></span><span style="font-size:small">(</span><span style="font-size:small">g_tutorial_02_gl2_frag</span><span style="font-size:small">), &amp;</span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">vertex_shader</span><span style="font-size:small">   = </span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">fragment_shader</span><span style="font-size:small"> = </span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">delete</span></span><span style="font-size:small"> [] </span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small">;     </span><span style="font-size:small">p_vertex_shader</span><span style="font-size:small"> = 0;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">delete</span></span><span style="font-size:small"> [] </span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small">; </span><span style="font-size:small">p_fragment_shader</span><span style="font-size:small"> = 0;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">z_lib_return_code_vertex</span><span style="font-size:small"> &lt;= 0 || </span><span style="font-size:small">z_lib_return_code_fragment</span><span style="font-size:small"> &lt;= 0 || !</span><span style="font-size:small">vertex_shader</span><span style="font-size:small">.</span><span style="font-size:small">size</span><span style="font-size:small">() || !</span><span style="font-size:small">fragment_shader</span><span style="font-size:small">.</span><span style="font-size:small">size</span><span style="font-size:small">())</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:blue">throw</span></span><span style="font-size:small"> </span><span style="font-size:small">Exception</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"Cannot decode the shader using ZLib."</span></span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_display_shader</span><span style="font-size:small">.</span><span style="font-size:small">setLabels</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"display.vert"</span></span></span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"display.frag"</span></span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_display_shader</span><span style="font-size:small">.</span><span style="font-size:small">loadSource</span><span style="font-size:small">(</span><span style="font-size:small">vertex_shader</span><span style="font-size:small">, </span><span style="font-size:small">fragment_shader</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">checkOpenGLErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-----------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">initGL</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-----------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Enable the Z-buffer</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glEnable</span><span style="font-size:small">(</span><span style="font-size:small">GL_DEPTH_TEST</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Set the background colour</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glClearColor</span><span style="font-size:small">(0.5, 0.5, 0.5, 1.0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Check if any OpenGL error has occurred.</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// If any has, an exception is thrown</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">checkOpenGLErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">load3DObjects</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Centre of the cubes</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">cube_centre</span><span style="font-size:small">(0, 0, 0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Size of the cubes</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">RATIONAL_NUMBER</span><span style="font-size:small"> </span><span style="font-size:small">length_1</span><span style="font-size:small">( 5.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">RATIONAL_NUMBER</span><span style="font-size:small"> </span><span style="font-size:small">length_2</span><span style="font-size:small">(10.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Create the cube using vertex data and index data</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">buildCube</span><span style="font-size:small">(</span><span style="font-size:small">length_1</span><span style="font-size:small">, </span><span style="font-size:small">cube_centre</span><span style="font-size:small">, </span><span style="font-size:small">g_p_vertex_set_1</span><span style="font-size:small">, </span><span style="font-size:small">g_p_index_set_1</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Create the cube using vertex data only</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">buildCube</span><span style="font-size:small">(</span><span style="font-size:small">length_2</span><span style="font-size:small">, </span><span style="font-size:small">cube_centre</span><span style="font-size:small">, </span><span style="font-size:small">g_p_vertex_set_2</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Set geometry (using VAOs and VBOs)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_polygon_mesh_1</span><span style="font-size:small">.</span><span style="font-size:small">setExternalData</span><span style="font-size:small">(</span><span style="font-size:small">GL_TRIANGLES</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">            &amp;</span><span style="font-size:small">g_p_vertex_set_1</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">            &amp;</span><span style="font-size:small">g_p_index_set_1</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small"><span style="color:blue">true</span></span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">GL_STATIC_DRAW</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_polygon_mesh_2</span><span style="font-size:small">.</span><span style="font-size:small">setExternalData</span><span style="font-size:small">(</span><span style="font-size:small">GL_TRIANGLES</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">            &amp;</span><span style="font-size:small">g_p_vertex_set_2</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small"><span style="color:blue">true</span></span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">GL_STATIC_DRAW</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">displayCallback</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Clear the buffers</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glClear</span><span style="font-size:small">(</span><span style="font-size:small">GL_COLOR_BUFFER_BIT</span><span style="font-size:small"> | </span><span style="font-size:small">GL_DEPTH_BUFFER_BIT</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Add the current shader to the shader stack</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pushShaderProgram</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Enable the shader</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_display_shader</span><span style="font-size:small">.</span><span style="font-size:small">enable</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">GLint</span><span style="font-size:small"> </span><span style="font-size:small">shader_id</span><span style="font-size:small">(</span><span style="font-size:small">g_display_shader</span><span style="font-size:small">.</span><span style="font-size:small">getProgramHandle</span><span style="font-size:small">());</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Check the status of OpenGL and of the current FBO</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">checkFBOErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">checkOpenGLErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// A handle for shader resources</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">GLuint</span><span style="font-size:small"> </span><span style="font-size:small">handle</span><span style="font-size:small">(0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Upload the projection matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">handle</span><span style="font-size:small"> = </span><span style="font-size:small">glGetUniformLocation</span><span style="font-size:small">(</span><span style="font-size:small">shader_id</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"g_projection_matrix"</span></span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glUniformMatrix4fv</span><span style="font-size:small">(</span><span style="font-size:small">handle</span><span style="font-size:small">, 1, </span><span style="font-size:small">GL_FALSE</span><span style="font-size:small">, </span><span style="font-size:small">g_current_projection_matrix</span><span style="font-size:small">.</span><span style="font-size:small">get</span><span style="font-size:small">());</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">checkOpenGLErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Upload the modelview matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">handle</span><span style="font-size:small"> = </span><span style="font-size:small">glGetUniformLocation</span><span style="font-size:small">(</span><span style="font-size:small">shader_id</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">"g_modelview_matrix"</span></span></span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glUniformMatrix4fv</span><span style="font-size:small">(</span><span style="font-size:small">handle</span><span style="font-size:small">, 1, </span><span style="font-size:small">GL_FALSE</span><span style="font-size:small">, </span><span style="font-size:small">g_current_modelview_matrix</span><span style="font-size:small">.</span><span style="font-size:small">get</span><span style="font-size:small">());</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">checkOpenGLErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Store the current transformation matrices</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pushModelViewMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pushProjectionMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Rotate the 3D scene</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_modelview_matrix</span><span style="font-size:small"> *= </span><span style="font-size:small">g_scene_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Store the current transformation matrices</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pushModelViewMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Translate the 1st object</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_modelview_matrix</span><span style="font-size:small"> *= </span><span style="font-size:small">MATRIX4</span><span style="font-size:small">::</span><span style="font-size:small">buildTranslationMatrix</span><span style="font-size:small">(</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small">(8.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">, 0.0, 0.0));</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Rotate the 1st object</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_modelview_matrix</span><span style="font-size:small"> *= </span><span style="font-size:small">g_object_1_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Apply the change to the shader program</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">applyModelViewMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Display the 1st object</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_polygon_mesh_1</span><span style="font-size:small">.</span><span style="font-size:small">display</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Restore the current transformation matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">popModelViewMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">popProjectionMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Store the current transformation matrices</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pushModelViewMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">pushProjectionMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Translate the 2nd object</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_modelview_matrix</span><span style="font-size:small"> *= </span><span style="font-size:small">MATRIX4</span><span style="font-size:small">::</span><span style="font-size:small">buildTranslationMatrix</span><span style="font-size:small">(</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small">(-8.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">, 0.0, 0.0));</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Rotate the 2nd object</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_modelview_matrix</span><span style="font-size:small"> *= </span><span style="font-size:small">g_object_2_rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Apply the change to the shader program</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">applyModelViewMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Display the 2nd object</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_polygon_mesh_2</span><span style="font-size:small">.</span><span style="font-size:small">display</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Restore the current transformation matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">popModelViewMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">popModelViewMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">popProjectionMatrix</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Disable the shader and restore the previous shader from the stack</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">popShaderProgram</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Check the status of OpenGL and of the current FBO</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">checkFBOErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">checkOpenGLErrorStatus</span><span style="font-size:small">(</span><span style="font-size:small">__FILE__</span><span style="font-size:small">, </span><span style="font-size:small">__FUNCTION__</span><span style="font-size:small">, </span><span style="font-size:small">__LINE__</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Swap front and back buffers</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glutSwapBuffers</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-----------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">idleCallback</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-----------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Rotate the objects</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_object_1_rotation_matrix</span><span style="font-size:small">.</span><span style="font-size:small">rotate</span><span style="font-size:small">(.01, </span><span style="font-size:small">VEC3</span><span style="font-size:small">(1.0, 0.0, 0.0));</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_object_2_rotation_matrix</span><span style="font-size:small">.</span><span style="font-size:small">rotate</span><span style="font-size:small">(.02, </span><span style="font-size:small">VEC3</span><span style="font-size:small">(0.0, 1.0, 0.0));</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Redisplay the scene</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">glutPostRedisplay</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-----------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">quitCallback</span><span style="font-size:small">()</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-----------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// The window exists</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_window_id</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Close the window</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">glutDestroyWindow</span><span style="font-size:small">(</span><span style="font-size:small">g_window_id</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">g_window_id</span><span style="font-size:small"> = 0;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">width</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">height</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Avoid a division by zero</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">height</span><span style="font-size:small"> == 0)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Prevent divide by 0</span></span></span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">height</span><span style="font-size:small"> = 1;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">x</span><span style="font-size:small">(0), </span><span style="font-size:small">y</span><span style="font-size:small">(0), </span><span style="font-size:small">w</span><span style="font-size:small">(</span><span style="font-size:small">width</span><span style="font-size:small">), </span><span style="font-size:small">h</span><span style="font-size:small">(</span><span style="font-size:small">height</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Store the width and height of the window</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_window_width</span><span style="font-size:small"> = </span><span style="font-size:small">width</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_window_height</span><span style="font-size:small"> = </span><span style="font-size:small">height</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Compute the aspect ratio of the size of the window</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small"> </span><span style="font-size:small">screen_aspect_ratio</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">) / </span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small">(</span><span style="font-size:small">g_window_height</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Update the viewport</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">glViewport</span><span style="font-size:small">(</span><span style="font-size:small">x</span><span style="font-size:small">, </span><span style="font-size:small">y</span><span style="font-size:small">, </span><span style="font-size:small">w</span><span style="font-size:small">, </span><span style="font-size:small">h</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Set up the projection matrix (g_current_projection_matrix)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">loadPerspectiveProjectionMatrix</span><span style="font-size:small">(45.0, </span><span style="font-size:small">screen_aspect_ratio</span><span style="font-size:small">, 0.1 * </span><span style="font-size:small">cm</span><span style="font-size:small">, 5000.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Set up the modelling-viewing matrix (g_current_modelview_matrix)</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">loadLookAtModelViewMatrix</span><span style="font-size:small">(0.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">, 0.0 * </span><span style="font-size:small">cm</span><span style="font-size:small">, </span><span style="font-size:small">g_zoom</span><span style="font-size:small">,</span><span style="font-size:small">
</span><span style="font-size:small">            0.0, 0.0, 0.0,</span><span style="font-size:small">
</span><span style="font-size:small">            0.0, 1.0, 0.0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Redisplay the scene</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">glutPostRedisplay</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//------------------------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">keyCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">unsigned</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">char</span></span><span style="font-size:small"> </span><span style="font-size:small">aKey</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//------------------------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:blue">switch</span></span><span style="font-size:small">(</span><span style="font-size:small">aKey</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">  {</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Close the program</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:blue">case</span></span><span style="font-size:small"> 27:</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:blue">case</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:#9300D1"><span style="font-size:small">'q'</span></span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">quitCallback</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">exit</span><span style="font-size:small">(</span><span style="font-size:small">EXIT_SUCCESS</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">break</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:blue">default</span></span><span style="font-size:small">:</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">break</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Redisplay the scene</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">glutPostRedisplay</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-------------------------------------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">mouseButtonCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aButton</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aState</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//-------------------------------------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_button</span><span style="font-size:small"> = </span><span style="font-size:small">aButton</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_button_state</span><span style="font-size:small"> = </span><span style="font-size:small">aState</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// This is a click event</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_button</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_LEFT_BUTTON</span><span style="font-size:small"> || </span><span style="font-size:small">g_button</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_RIGHT_BUTTON</span><span style="font-size:small"> || </span><span style="font-size:small">g_button</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_MIDDLE_BUTTON</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Use the arc ball</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_button_state</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_DOWN</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">g_use_arc_ball</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="color:blue">true</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Stop using the arc ball</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">else</span></span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">g_use_arc_ball</span><span style="font-size:small"> = </span><span style="font-size:small"><span style="color:blue">false</span></span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small"> </span><span style="font-size:small">xpos</span><span style="font-size:small">(</span><span style="font-size:small">aXPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">double</span></span><span style="font-size:small"> </span><span style="font-size:small">ypos</span><span style="font-size:small">(</span><span style="font-size:small">aYPosition</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_last_x_position</span><span style="font-size:small"> = </span><span style="font-size:small">xpos</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small"> = </span><span style="font-size:small">ypos</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_x_position</span><span style="font-size:small"> = </span><span style="font-size:small">xpos</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small"> = </span><span style="font-size:small">ypos</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// The button is down</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">aState</span><span style="font-size:small"> == </span><span style="font-size:small">GLUT_DOWN</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">  {</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// This is a wheel event</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">aButton</span><span style="font-size:small"> == 3)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Change the zoom</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">g_zoom</span><span style="font-size:small"> += 5 * </span><span style="font-size:small">cm</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Update the projection matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">, </span><span style="font-size:small">g_window_height</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// This is a wheel event</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">else</span></span><span style="font-size:small"> </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">aButton</span><span style="font-size:small"> == 4)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Change the zoom</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">g_zoom</span><span style="font-size:small"> -= 5 * </span><span style="font-size:small">cm</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Update the projection matrix</span></span></span><span style="font-size:small">
</span><span style="font-size:small">      </span><span style="font-size:small">framebufferSizeCallback</span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">, </span><span style="font-size:small">g_window_height</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">  }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Redisplay the scene</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">glutPostRedisplay</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//----------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">cursorPosCallback</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aXPosition</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">aYPosition</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//----------------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_x_position</span><span style="font-size:small"> = </span><span style="font-size:small">aXPosition</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small"> = </span><span style="font-size:small">aYPosition</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">computeRotation</span><span style="font-size:small">(</span><span style="font-size:small">g_scene_rotation_matrix</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Redisplay the scene</span></span></span><span style="font-size:small">
</span><span style="font-size:small">  </span><span style="font-size:small">glutPostRedisplay</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//---------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">getArcballVector</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">x</span><span style="font-size:small">, </span><span style="font-size:small"><span style="color:blue">int</span></span><span style="font-size:small"> </span><span style="font-size:small">y</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//---------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">P</span><span style="font-size:small">(2.0 * </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">(</span><span style="font-size:small">x</span><span style="font-size:small">) / </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">(</span><span style="font-size:small">g_window_width</span><span style="font-size:small">) - 1.0,</span><span style="font-size:small">
</span><span style="font-size:small">           2.0 * </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">(</span><span style="font-size:small">y</span><span style="font-size:small">) / </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small">(</span><span style="font-size:small">g_window_height</span><span style="font-size:small">) - 1.0,</span><span style="font-size:small">
</span><span style="font-size:small">           0);</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">setY</span><span style="font-size:small">(-</span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getY</span><span style="font-size:small">());</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">OP_squared</span><span style="font-size:small"> = </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getX</span><span style="font-size:small">() * </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getX</span><span style="font-size:small">() + </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getY</span><span style="font-size:small">() * </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">getY</span><span style="font-size:small">();</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">OP_squared</span><span style="font-size:small"> &lt;= 1.0)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">setZ</span><span style="font-size:small">(</span><span style="font-size:small">sqrt</span><span style="font-size:small">(1.0 - </span><span style="font-size:small">OP_squared</span><span style="font-size:small">));  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Pythagore</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">else</span></span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small">P</span><span style="font-size:small">.</span><span style="font-size:small">normalise</span><span style="font-size:small">();  </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">// Nearest point</span></span></span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">return</span></span><span style="font-size:small"> (</span><span style="font-size:small">P</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">radian2degree</span><span style="font-size:small">(</span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">anAngle</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">return</span></span><span style="font-size:small"> (180.0 * </span><span style="font-size:small">anAngle</span><span style="font-size:small"> / </span><span style="font-size:small">gVirtualXRay</span><span style="font-size:small">::</span><span style="font-size:small">PI</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">}</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:blue">void</span></span><span style="font-size:small"> </span><span style="font-size:small">computeRotation</span><span style="font-size:small">(</span><span style="font-size:small">MATRIX4</span><span style="font-size:small">&amp; </span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//--------------------------------------------</span></span></span><span style="font-size:small">
</span><span style="font-size:small">{</span><span style="font-size:small">
</span><span style="font-size:small">    </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_use_arc_ball</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">    {</span><span style="font-size:small">
</span><span style="font-size:small">        </span><span style="font-size:small"><span style="color:blue">if</span></span><span style="font-size:small"> (</span><span style="font-size:small">g_current_x_position</span><span style="font-size:small"> != </span><span style="font-size:small">g_last_x_position</span><span style="font-size:small"> || </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small"> != </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small">)</span><span style="font-size:small">
</span><span style="font-size:small">        {</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">va</span><span style="font-size:small">(</span><span style="font-size:small">getArcballVector</span><span style="font-size:small">(</span><span style="font-size:small">g_last_x_position</span><span style="font-size:small">,    </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">vb</span><span style="font-size:small">(</span><span style="font-size:small">getArcballVector</span><span style="font-size:small">(</span><span style="font-size:small">g_current_x_position</span><span style="font-size:small">, </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small">));</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small"><span style="color:blue">float</span></span><span style="font-size:small"> </span><span style="font-size:small">angle</span><span style="font-size:small">(</span><span style="font-size:small">g_rotation_speed</span><span style="font-size:small"> * </span><span style="font-size:small">radian2degree</span><span style="font-size:small">(</span><span style="font-size:small">acos</span><span style="font-size:small">(</span><span style="font-size:small">min</span><span style="font-size:small">(1.0, </span><span style="font-size:small">va</span><span style="font-size:small">.</span><span style="font-size:small">dotProduct</span><span style="font-size:small">(</span><span style="font-size:small">vb</span><span style="font-size:small">)))));</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">axis_in_camera_coord</span><span style="font-size:small">(</span><span style="font-size:small">va</span><span style="font-size:small"> ^ </span><span style="font-size:small">vb</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//axis_in_camera_coord.normalize();</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">camera2object</span><span style="font-size:small">(</span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small">.</span><span style="font-size:small">getInverse</span><span style="font-size:small">());</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">VEC3</span><span style="font-size:small"> </span><span style="font-size:small">axis_in_object_coord</span><span style="font-size:small"> = </span><span style="font-size:small">camera2object</span><span style="font-size:small"> * </span><span style="font-size:small">axis_in_camera_coord</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small"><span style="color:#009900"><span style="font-size:small">//axis_in_object_coord.normalize();</span></span></span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">MATRIX4</span><span style="font-size:small"> </span><span style="font-size:small">rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">rotation_matrix</span><span style="font-size:small">.</span><span style="font-size:small">rotate</span><span style="font-size:small">(</span><span style="font-size:small">angle</span><span style="font-size:small">, </span><span style="font-size:small">axis_in_object_coord</span><span style="font-size:small">);</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small"> = </span><span style="font-size:small">aRotationMatrix</span><span style="font-size:small"> * </span><span style="font-size:small">rotation_matrix</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">g_last_x_position</span><span style="font-size:small"> = </span><span style="font-size:small">g_current_x_position</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">            </span><span style="font-size:small">g_last_y_position</span><span style="font-size:small"> = </span><span style="font-size:small">g_current_y_position</span><span style="font-size:small">;</span><span style="font-size:small">
</span><span style="font-size:small">        }</span><span style="font-size:small">
</span><span style="font-size:small">    }</span><span style="font-size:small">
</span><span style="font-size:small">}</span></td></tr>
</table>
</div><!--BEGIN NOTES document-->
<hr class="footnoterule"><dl class="thefootnotes"><dt class="dt-thefootnotes">
<a id="note1" href="#text1">1</a></dt><dd class="dd-thefootnotes"><div class="footnotetext"><a href="http://www.gzip.org/"><span style="font-family:monospace">http://www.gzip.org/</span></a></div></dd><dt class="dt-thefootnotes"><a id="note2" href="#text2">2</a></dt><dd class="dd-thefootnotes"><div class="footnotetext"><a href="http://www.cmake.org/"><span style="font-family:monospace">http://www.cmake.org/</span></a></div></dd><dt class="dt-thefootnotes"><a id="note3" href="#text3">3</a></dt><dd class="dd-thefootnotes"><div class="footnotetext"><a href="http://sourceforge.net/projects/bin2c/"><span style="font-family:monospace">http://sourceforge.net/projects/bin2c/</span></a></div></dd><dt class="dt-thefootnotes"><a id="note4" href="#text4">4</a></dt><dd class="dd-thefootnotes"><div class="footnotetext"><a href="http://www.zlib.net/"><span style="font-family:monospace">http://www.zlib.net/</span></a></div></dd></dl>
<!--END NOTES-->
<!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr style="height:2"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H</em><em><span style="font-size:small"><sup>E</sup></span></em><em>V</em><em><span style="font-size:small"><sup>E</sup></span></em><em>A</em></a><em>.</em></blockquote></body>
</html>
